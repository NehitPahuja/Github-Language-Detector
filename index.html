<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Most Used Languages – GitHub Card</title>
  <style>
    :root{
      --bg:#000;
      --bg-soft:#121212;
      --panel:#181818;
      --panel-soft:#1f1f1f;
      --text:#fff;
      --muted:#b3b3b3;
      --accent:#1db954;
      --border:#282828;
      --radius:18px;
      --shadow:0 30px 60px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      display:flex;
    }

    .app{
      display:flex;
      flex:1;
      min-height:100vh;
      background:radial-gradient(1200px 600px at 12% -10%, rgba(30,215,96,.18), transparent),
        radial-gradient(900px 600px at 110% 0%, rgba(29,185,84,.2), transparent),
        var(--bg);
    }

    .sidebar{
      width:240px;
      padding:28px 24px 36px;
      background:#000;
      border-right:1px solid #111;
      display:flex;
      flex-direction:column;
      gap:28px;
    }

    .logo{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:20px;
      font-weight:700;
      letter-spacing:.5px;
    }

    .logo::before{
      content:"";
      width:30px;
      height:30px;
      border-radius:50%;
      background:var(--accent);
      box-shadow:0 8px 30px rgba(30,215,96,.45);
    }

    nav{
      display:grid;
      gap:8px;
      font-size:15px;
    }

    nav a{
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
      padding:10px 12px;
      border-radius:10px;
      transition:color .2s ease, background .2s ease;
    }

    nav a.active,
    nav a:hover{
      color:var(--text);
      background:rgba(255,255,255,.08);
    }

    .playlist{
      margin-top:auto;
      font-size:12px;
      line-height:1.6;
      color:var(--muted);
      border-top:1px solid rgba(255,255,255,.04);
      padding-top:18px;
    }

    .main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:32px;
      padding:38px 44px 56px;
      background:linear-gradient(180deg, rgba(18,18,18,.85), rgba(18,18,18,.98));
      overflow:auto;
    }

    .hero{
      position:relative;
      background:linear-gradient(140deg, rgba(29,185,84,.6), rgba(25,20,20,.9) 60%);
      border-radius:calc(var(--radius) + 8px);
      padding:38px;
      overflow:hidden;
      box-shadow:var(--shadow);
    }

    .hero::after{
      content:"";
      position:absolute;
      width:300px;
      height:300px;
      background:radial-gradient(circle, rgba(30,215,96,.45), transparent 60%);
      right:-120px;
      top:-120px;
      filter:blur(0px);
    }

    .hero small{
      text-transform:uppercase;
      letter-spacing:3px;
      font-weight:600;
      color:rgba(255,255,255,.8);
    }

    .hero h1{
      margin:14px 0 16px;
      font-size:46px;
      line-height:1.05;
      letter-spacing:-1px;
    }

    .hero p{
      margin:0;
      font-size:16px;
      max-width:560px;
      color:rgba(255,255,255,.88);
    }

    .panel{
      background:var(--panel);
      border-radius:var(--radius);
      border:1px solid var(--border);
      padding:30px;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      display:grid;
      gap:22px;
    }

    h2{
      margin:0;
      font-size:22px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }

    .controls input{
      background:var(--panel-soft);
      color:var(--text);
      border:1px solid rgba(255,255,255,.08);
      border-radius:999px;
      padding:10px 18px;
      font-size:14px;
      min-width:220px;
      outline:none;
      transition:border .2s ease, background .2s ease;
    }

    .controls input:focus{
      border-color:var(--accent);
      background:rgba(29,185,84,.12);
    }

    .controls button{
      background:var(--accent);
      color:#000;
      border:none;
      border-radius:999px;
      padding:11px 28px;
      font-size:14px;
      font-weight:700;
      letter-spacing:.4px;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .2s ease;
      box-shadow:0 12px 24px rgba(29,185,84,.3);
    }

    .controls button:hover{
      transform:translateY(-1px);
      box-shadow:0 18px 34px rgba(29,185,84,.38);
    }

    .notice{
      flex:1 1 100%;
      font-size:13px;
      color:var(--muted);
    }

    .notice code{
      background:rgba(255,255,255,.05);
      padding:3px 6px;
      border-radius:6px;
      color:var(--text);
      font-family:"SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    }

    .bar{
      height:18px;
      width:100%;
      background:var(--panel-soft);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.06);
      display:flex;
    }

    .bar > span{height:100%;}

    .legend{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
      gap:14px 18px;
    }

    .legend-item{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:14px;
      font-weight:500;
      color:rgba(255,255,255,.9);
    }

    .dot{
      width:12px;
      height:12px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,.2);
    }

    .footer{
      display:flex;
      flex-wrap:wrap;
      gap:10px 18px;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      font-size:13px;
    }

    .error{
      color:#ff7f8a;
      font-size:14px;
      background:rgba(255,127,138,.12);
      border:1px solid rgba(255,127,138,.35);
      padding:10px 14px;
      border-radius:10px;
    }

    @media (max-width:1024px){
      .hero h1{font-size:38px;}
      .main{padding:28px 24px 48px;}
    }

    @media (max-width:900px){
      body{display:block;}
      .app{flex-direction:column; min-height:100vh;}
      .sidebar{
        width:100%;
        flex-direction:row;
        align-items:center;
        justify-content:space-between;
        gap:18px;
        border-right:none;
        border-bottom:1px solid #111;
      }
      nav{grid-auto-flow:column; justify-content:flex-start; overflow-x:auto; padding-bottom:6px;}
      nav a{white-space:nowrap;}
      .playlist{display:none;}
    }

    @media (max-width:620px){
      .controls{
        flex-direction:column;
        align-items:stretch;
      }
      .controls input,
      .controls button{width:100%;}
      .hero{padding:28px;}
      .hero h1{font-size:32px;}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo">Language Wrapped</div>
      <nav>
        <a class="active" href="#">Overview</a>
        <a href="#">Insights</a>
        <a href="#">Playlists</a>
        <a href="#">Radio</a>
      </nav>
      <div class="playlist">
        Curated for developers.
        <br />Drop in a GitHub username to remix their language stats.
      </div>
    </aside>

    <main class="main">
      <header class="hero">
        <small>GitHub Language Wrapped</small>
        <h1>Discover your repository soundscape</h1>
        <p>Visualize the languages powering a GitHub profile with a Spotify-inspired dashboard. Fetch their top languages and share the vibe.</p>
      </header>

      <section class="panel">
        <h2>Language mix</h2>
        <div class="controls">
          <input id="username" placeholder="GitHub username" />
          <input id="token" placeholder="Optional: GitHub token (ghp_...)" />
          <button id="load">Fetch</button>
          <span class="notice">Tip: add <code>?user=YOUR_NAME</code> to the URL.</span>
        </div>

        <div class="bar" id="bar"></div>

        <div class="legend" id="legend"></div>

        <div class="footer">
          <span id="summary">Waiting for data…</span>
          <span id="rate"></span>
        </div>

        <div class="error" id="error" hidden></div>
      </section>
    </main>
  </div>

  <script>
  // ---- Config ----
  const LANGUAGE_COLORS = {
    Python: "#3572A5", TypeScript: "#3178c6", JavaScript: "#f1e05a", HTML: "#e34c26", CSS: "#563d7c", "C++": "#f34b7d",
    Kotlin: "#A97BFF", Dart: "#00B4AB", Jupyter: "#DA5B0B", Shell:"#89e051", Go:"#00ADD8", Rust:"#dea584", Java:"#b07219",
  };

  const bar = document.getElementById('bar');
  const legend = document.getElementById('legend');
  const summary = document.getElementById('summary');
  const rate = document.getElementById('rate');
  const errorBox = document.getElementById('error');

  async function fetchJSON(url, token){
    const res = await fetch(url, { headers: token ? {Authorization: `token ${token}`} : {} });
    rate.textContent = res.headers.has('x-ratelimit-remaining') ? `rate left: ${res.headers.get('x-ratelimit-remaining')}` : '';
    if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);
    return res.json();
  }

  function fmtPct(n){return (Math.round(n * 10000) / 100).toFixed(2) + '%'}

  function render(data){
    // data: [{name, bytes}]
    data.sort((a,b)=>b.bytes-a.bytes);
    const total = data.reduce((s,d)=>s+d.bytes,0);
    bar.innerHTML = '';
    legend.innerHTML = '';
    errorBox.hidden = true;

    if(total === 0){
      summary.textContent = 'No language data found.';
      return;
    }

    // progress bar segments
    data.forEach(d=>{
      const span = document.createElement('span');
      const pct = d.bytes/total*100;
      span.style.width = pct + '%';
      span.style.background = LANGUAGE_COLORS[d.name] || '#888';
      span.title = `${d.name} ${fmtPct(d.bytes/total)}`;
      bar.appendChild(span);
    });

    // legend items (top 12)
    data.slice(0,12).forEach(d=>{
      const row = document.createElement('div');
      row.className='legend-item';
      row.innerHTML = `<span class="dot" style="background:${LANGUAGE_COLORS[d.name]||'#888'}"></span>
        <span>${d.name} ${fmtPct(d.bytes/total)}</span>`;
      legend.appendChild(row);
    });

    summary.textContent = `${data.length} languages · ${Intl.NumberFormat().format(total)} bytes analyzed`;
  }

  async function load(username, token){
    if(!username){ errorBox.hidden=false; errorBox.textContent='Enter a GitHub username.'; return; }
    summary.textContent = 'Fetching repos…';
    try{
      // Get all public repos (handle pagination up to 5 pages ~ 500 repos)
      let page=1, repos=[]; const perPage=100;
      while(page<=5){
        const batch = await fetchJSON(`https://api.github.com/users/${username}/repos?per_page=${perPage}&page=${page}`, token);
        repos = repos.concat(batch);
        if(batch.length < perPage) break; // no more pages
        page++;
      }
      if(repos.length === 0){ render([]); return; }

      // Fetch languages for each repo (languages_url)
      summary.textContent = `Fetching language stats for ${repos.length} repos…`;
      const results = await Promise.allSettled(
        repos.map(r => fetchJSON(r.languages_url, token))
      );

      const totals = new Map();
      results.forEach(r=>{
        if(r.status === 'fulfilled'){
          for(const [lang, bytes] of Object.entries(r.value)){
            totals.set(lang, (totals.get(lang)||0) + bytes);
          }
        }
      });

      const data = Array.from(totals, ([name, bytes])=>({name, bytes}));
      render(data);
    }catch(err){
      errorBox.hidden=false; errorBox.textContent = err.message + ' — try adding a GitHub token.';
      console.error(err);
    }
  }

  // UI wiring
  document.getElementById('load').addEventListener('click',()=>{
    load(document.getElementById('username').value.trim(), document.getElementById('token').value.trim());
  });

  // Autoload from query param ?user=NAME and optional ?token=TOKEN
  const params = new URLSearchParams(location.search);
  const userQP = params.get('user');
  const tokenQP = params.get('token');
  if(userQP){
    document.getElementById('username').value = userQP;
    if(tokenQP) document.getElementById('token').value = tokenQP;
    load(userQP, tokenQP||'');
  }
  </script>
</body>
</html>
